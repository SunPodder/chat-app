import{u as h,a as g,b as p,r as j,s as f,j as t,L as C,U as y,G as v}from"./index-BhQeG5K_.js";import{C as D,a as _,b as N,I as w,c as b}from"./input-DDaKLcAe.js";import{A as L,a as I,b as Y}from"./avatar-CEbp2X4h.js";import"./index-utpKsIgz.js";import"./index-BZpRwNlR.js";import"./index-BqoLo0Hk.js";const F=i=>{const a=new Date(i),o=new Date,c=a.getDate()===o.getDate()&&a.getMonth()===o.getMonth()&&a.getFullYear()===o.getFullYear(),u=a.getDate()===o.getDate()-1&&a.getMonth()===o.getMonth()&&a.getFullYear()===o.getFullYear();return c?a.toLocaleTimeString():u?"Yesterday":a.toLocaleDateString()};function T(){const i=h(y),a=g(),{data:o,error:c,isLoading:u}=p({queryKey:["chats"],queryFn:()=>v("/conversations/")});j.useEffect(()=>{f.on("sent_message",(s,n)=>{a.setQueryData(["chats"],e=>{if(!e)return e;const r=e.findIndex(l=>l.to.id===s.to);return r!==-1?[{to:e[r].to,last_message:s},...e.slice(0,r),...e.slice(r+1)]:[{last_message:s,to:n},...e]})}),f.on("recieve_message",(s,n)=>{a.setQueryData(["chats"],e=>{if(!e)return e;const r=e.findIndex(l=>l.to.id===s.from);return r!==-1?[{to:e[r].to,last_message:s},...e.slice(0,r),...e.slice(r+1)]:[{last_message:s,to:n},...e]})})},[a]);function x(s){const n=s.toLowerCase();n===""&&a.setQueryData(["chats"],e=>[...e].sort((r,l)=>new Date(l.last_message.created_at)-new Date(r.last_message.created_at))),a.setQueryData(["chats"],e=>[...e].sort((r,l)=>{const d=`${r.to.name.first} ${r.to.name.last}`.toLowerCase(),m=`${l.to.name.first} ${l.to.name.last}`.toLowerCase();return d.includes(n)&&!m.includes(n)?-1:!d.includes(n)&&m.includes(n)?1:0}))}return c?t.jsxs("div",{children:["Error: ",c.message]}):u?t.jsx("div",{children:"Loading..."}):t.jsxs(D,{className:"w-full h-full flex flex-col",children:[t.jsxs(_,{children:[t.jsx(N,{className:"py-2 flex items-center",children:t.jsx("span",{className:"flex-1",children:"Chats"})}),t.jsx("div",{className:"flex items-center",children:t.jsx(w,{type:"text",placeholder:"Search conversations",onChange:s=>x(s.target.value)})})]}),t.jsx(b,{children:t.jsx("div",{children:o.map((s,n)=>{var e;return t.jsxs(C,{className:"mb-2 p-4 cursor-pointer border-t border-b border-gray-200 grid gap-1",to:`/chat/${s.to.id}`,children:[t.jsxs("div",{className:"flex items-center w-full h-full gap-2",children:[t.jsxs(L,{className:"w-8 h-8",children:[t.jsx(I,{src:(e=s.to.avatar)==null?void 0:e.url,alt:s.to.name.first}),t.jsx(Y,{children:s.to.name.first[0]})]}),t.jsxs("div",{className:"font-semibold",children:[s.to.name.first," ",s.to.name.last]})]}),t.jsx("div",{children:t.jsxs("small",{className:"ml-3 flex",children:[t.jsxs("span",{className:"flex-1",children:[s.last_message.from===(i==null?void 0:i.id)&&"You: ",s.last_message.text||"Image"]}),F(s.last_message.created_at)]})})]},n)})})})]})}export{T as default};
